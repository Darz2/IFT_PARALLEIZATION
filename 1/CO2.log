units		    real
atom_style	    full
boundary        p p p
pair_style      lj/cut/coul/long 14
pair_modify     shift yes mix arithmetic tail no
kspace_style    pppm 1e-5
bond_style      harmonic
angle_style     harmonic
processors      1 1 1

#----------------------------------------------------------------------------#
#                               Variables
#----------------------------------------------------------------------------#

variable  TEMP_INDEX       equal 220
variable  simulationTemp   equal ${TEMP_INDEX}
variable  simulationTemp   equal 220
variable  timestep         equal 0.5
variable  RandomSeed       equal 1000
variable  Seed_L           equal ${RandomSeed}*7
variable  Seed_L           equal 1000*7
variable  Seed_V1          equal ${RandomSeed}*2
variable  Seed_V1          equal 1000*2
variable  Seed_V2          equal ${RandomSeed}*5
variable  Seed_V2          equal 1000*5

variable  nz_bin           equal 100
variable  bin_size         equal 1/${nz_bin}
variable  bin_size         equal 1/100
variable  restartfreq      equal 2000000        # 1 ns
variable  balance_freq     equal 8000000        # 4 ns
variable  thermo_num       equal 1000
variable  Lz               equal lz
variable  TEMPERATURE      equal temp
variable  PRESSURE         equal press
variable  KE               equal ke
variable  PE               equal pe
variable  TOT_ENG          equal etotal
variable  ECOUPLE          equal ecouple
variable  ECONSERVE        equal econserve
variable  Nnvt             equal 200000     # 1 ns

#----------------------------------------------------------------------------#
#                        Simulation cell creation
#----------------------------------------------------------------------------#

region          box block 0 40 0 40 0 240

create_box      2 box                                       bond/types 1                                angle/types 1                               extra/bond/per/atom 2                       extra/angle/per/atom 1                      extra/special/per/atom 2
Created orthogonal box = (0 0 0) to (40 40 240)
  1 by 1 by 1 MPI processor grid

molecule        co2mol CO2.mol
Read molecule template co2mol:
# CO2 molecule file. TraPPE-Flex model.
  1 molecules
  0 fragments
  3 atoms with max type 2
  2 bonds with max type 1
  1 angles with max type 1
  0 dihedrals with max type 0
  0 impropers with max type 0
print           "Molecule file loaded successfully"
Molecule file loaded successfully

region          liquid  block 0 40 0 40 75 165
region          vapor_1 block 0 40 0 40 0 75
region          vapor_2 block 0 40 0 40 165 240

create_atoms   	0 random 2298 ${Seed_L}  liquid  mol co2mol 3 overlap 2 maxtry 10000
create_atoms   	0 random 2298 7000  liquid  mol co2mol 3 overlap 2 maxtry 10000
Created 6894 atoms
  using lattice units in orthogonal box = (0 0 0) to (40 40 240)
  create_atoms CPU = 1.652 seconds
create_atoms   	0 random 26 ${Seed_V1} vapor_1 mol co2mol 3 overlap 2 maxtry 10000
create_atoms   	0 random 26 2000 vapor_1 mol co2mol 3 overlap 2 maxtry 10000
Created 78 atoms
  using lattice units in orthogonal box = (0 0 0) to (40 40 240)
  create_atoms CPU = 0.007 seconds
create_atoms   	0 random 26 ${Seed_V2} vapor_2 mol co2mol 3 overlap 2 maxtry 10000
create_atoms   	0 random 26 5000 vapor_2 mol co2mol 3 overlap 2 maxtry 10000
Created 78 atoms
  using lattice units in orthogonal box = (0 0 0) to (40 40 240)
  create_atoms CPU = 0.008 seconds

include         trappe_flex.FF
#----------------------------------------------------------------------------#
# FORCEFIELD - TraPPE Flexible model for CO2 (DOI- 10.1021/acs.jced.9b00006)
#----------------------------------------------------------------------------#

pair_coeff      1   1  0.0536545107   2.8         # O=[C]=O
pair_coeff      2   2  0.1569891239   3.05        # [O]=C=O

bond_coeff      1   1028.266  1.16

angle_coeff     1   55.96  180

mass            1   12.010700                     # C
mass            2   15.999400                     # O

set type        1   charge     +0.7000            # C
Setting atom values ...
  2350 settings made for charge
set type        2   charge     -0.3500            # O
Setting atom values ...
  4700 settings made for charge
# read_restart   restart_CO2.2

print           "lz=${Lz}"
lz=240

#----------------------------------------------------------------------------#
#                           GROUPS / NEIGHBOUR-LIST / BALANCE
#----------------------------------------------------------------------------#

group           car  type 1
2350 atoms in group car
group           oxy  type 2
4700 atoms in group oxy

neighbor	    3.0 bin
neigh_modify    every 1 delay 0 check yes
run_style       verlet
balance         0.8 shift xyz 20 1.2 out tmp.balance
Balancing ...
PPPM initialization ...
  using 12-bit tables for long-range coulomb (src/kspace.cpp:342)
  G vector (1/distance) = 0.20169663
  grid = 24 24 80
  stencil order = 5
  estimated absolute RMS force accuracy = 0.00286774
  estimated relative force accuracy = 8.6361139e-06
  using single precision FFTW3
  3d grid and FFT values/proc = 82646 46080
Generated 1 of 1 mixed pair_coeff terms from arithmetic mixing rule
Last active /omp style is kspace_style pppm/omp
Neighbor list info ...
  update: every = 1 steps, delay = 0 steps, check = yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 17
  ghost atom cutoff = 17
  binsize = 8.5, bins = 5 5 29
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair lj/cut/coul/long/omp, perpetual
      attributes: half, newton on, omp
      pair build: half/bin/newton/omp
      stencil: half/bin/3d
      bin: standard
 rebalancing time: 0.006 seconds
  iteration count = 1
  initial/final maximal load/proc = 7050 7050
  initial/final imbalance factor  = 1 1
  x cuts: 0 1
  y cuts: 0 1
  z cuts: 0 1

#----------------------------------------------------------------------------#
#                           CONGUGATE-GRADIENT MINIMIZATION/Initialization
#----------------------------------------------------------------------------#

minimize        1e-6 1e-8 100000 10000000
PPPM initialization ...
  using 12-bit tables for long-range coulomb (src/kspace.cpp:342)
  G vector (1/distance) = 0.20169663
  grid = 24 24 80
  stencil order = 5
  estimated absolute RMS force accuracy = 0.00286774
  estimated relative force accuracy = 8.6361139e-06
  using single precision FFTW3
  3d grid and FFT values/proc = 82646 46080
Generated 1 of 1 mixed pair_coeff terms from arithmetic mixing rule
Last active /omp style is kspace_style pppm/omp
Per MPI rank memory allocation (min/avg/max) = 33.57 | 33.57 | 33.57 Mbytes
   Step          Temp          E_pair         E_mol          TotEng         Press     
         0   0              49336.872      7.9026918e-12  49336.872      43177.231    
      4164   0             -12061.324      22.621082     -12038.703     -242.70439    
Loop time of 689.359 on 1 procs for 4164 steps with 7050 atoms

99.5% CPU use with 1 MPI tasks x 1 OpenMP threads

Minimization stats:
  Stopping criterion = energy tolerance
  Energy initial, next-to-last, final = 
      49336.8715510149  -12038.6907174316  -12038.7026839949
  Force two-norm initial, final = 12256.268 5.7601729
  Force max component initial, final = 805.65186 0.52719177
  Final line search alpha, max atom move = 0.043647524 0.023010615
  Iterations, force evaluations = 4164 8258

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 634.07     | 634.07     | 634.07     |   0.0 | 91.98
Bond    | 1.8168     | 1.8168     | 1.8168     |   0.0 |  0.26
Kspace  | 47.556     | 47.556     | 47.556     |   0.0 |  6.90
Neigh   | 3.7654     | 3.7654     | 3.7654     |   0.0 |  0.55
Comm    | 0.95398    | 0.95398    | 0.95398    |   0.0 |  0.14
Output  | 0          | 0          | 0          |   0.0 |  0.00
Modify  | 0.10542    | 0.10542    | 0.10542    |   0.0 |  0.02
Other   |            | 1.088      |            |       |  0.16

Nlocal:           7050 ave        7050 max        7050 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:          17234 ave       17234 max       17234 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:    3.90986e+06 ave 3.90986e+06 max 3.90986e+06 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 3909857
Ave neighs/atom = 554.58965
Ave special neighs/atom = 2
Neighbor list builds = 40
Dangerous builds = 0
fix             COM_DRIFT all momentum 1 linear 1 1 1 rescale
velocity        all create ${simulationTemp} ${RandomSeed} mom yes rot yes dist gaussian
velocity        all create 220 ${RandomSeed} mom yes rot yes dist gaussian
velocity        all create 220 1000 mom yes rot yes dist gaussian
velocity        all zero linear
velocity        all zero angular
thermo_style    custom step etotal press temp dt
thermo_modify   flush yes
thermo          ${thermo_num}
thermo          1000
reset_timestep  0
write_data      ${NAME}_init.data
write_data      CO2_init.data
System init for write_data ...
PPPM initialization ...
  using 12-bit tables for long-range coulomb (src/kspace.cpp:342)
  G vector (1/distance) = 0.20169663
  grid = 24 24 80
  stencil order = 5
  estimated absolute RMS force accuracy = 0.00286774
  estimated relative force accuracy = 8.6361139e-06
  using single precision FFTW3
  3d grid and FFT values/proc = 82646 46080
Generated 1 of 1 mixed pair_coeff terms from arithmetic mixing rule
Last active /omp style is kspace_style pppm/omp

#----------------------------------------------------------------------------#
#                           Compute
#----------------------------------------------------------------------------#

compute         layers  all chunk/atom bin/1d z lower ${bin_size} units reduced
compute         layers  all chunk/atom bin/1d z lower 0.01 units reduced
compute         T       all temp
compute         pTensor all pressure T
compute         mom     all momentum

variable        TM      equal mass(all)
variable        vx_com  equal c_mom[1]/v_TM
variable        vy_com  equal c_mom[2]/v_TM
variable        vz_com  equal c_mom[3]/v_TM

#----------------------------------------------------------------------------#
#                           Write Headers to Files
#----------------------------------------------------------------------------#

print "#Step Pxx Pyy Pzz" file pressure_tensor.dat
#Step Pxx Pyy Pzz
print "#Step temp press ke pe etotal ecouple econserve" file Energy.dat
#Step temp press ke pe etotal ecouple econserve
print "#Step px py pz COM_vx COM_vy COM_vz" file Momentum.dat
#Step px py pz COM_vx COM_vy COM_vz

#----------------------------------------------------------------------------#
#                           NVT (Initialization/Production)
#----------------------------------------------------------------------------#

fix             NVE          all    nve
fix             NVT          all    temp/csvr  ${simulationTemp} ${simulationTemp} 100 ${RandomSeed}
fix             NVT          all    temp/csvr  220 ${simulationTemp} 100 ${RandomSeed}
fix             NVT          all    temp/csvr  220 220 100 ${RandomSeed}
fix             NVT          all    temp/csvr  220 220 100 1000
fix             CPU_BALANCE  all    balance    ${balance_freq} 0.8 shift xyz 20 1.2
fix             CPU_BALANCE  all    balance    8000000 0.8 shift xyz 20 1.2
fix		        dens_profile all    ave/chunk  10 100 1000 layers density/mass file massdens_profile.dat
fix             1            all    ave/time   10 100 1000 c_pTensor[1] c_pTensor[2] c_pTensor[3] file pressure_tensor.dat
fix             2            all    ave/time   ${thermo_num} 1 ${thermo_num} v_TEMPERATURE v_PRESSURE v_KE v_PE v_TOT_ENG v_ECOUPLE v_ECONSERVE file Energy.dat
fix             2            all    ave/time   1000 1 ${thermo_num} v_TEMPERATURE v_PRESSURE v_KE v_PE v_TOT_ENG v_ECOUPLE v_ECONSERVE file Energy.dat
fix             2            all    ave/time   1000 1 1000 v_TEMPERATURE v_PRESSURE v_KE v_PE v_TOT_ENG v_ECOUPLE v_ECONSERVE file Energy.dat
fix             3            all    ave/time   ${thermo_num} 1 ${thermo_num} c_mom[1] c_mom[2] c_mom[3] v_vx_com v_vy_com v_vz_com file Momentum.dat
fix             3            all    ave/time   1000 1 ${thermo_num} c_mom[1] c_mom[2] c_mom[3] v_vx_com v_vy_com v_vz_com file Momentum.dat
fix             3            all    ave/time   1000 1 1000 c_mom[1] c_mom[2] c_mom[3] v_vx_com v_vy_com v_vz_com file Momentum.dat

timestep        0.5
restart         ${restartfreq} restart_${NAME}.1 restart_${NAME}.2
restart         2000000 restart_${NAME}.1 restart_${NAME}.2
restart         2000000 restart_CO2.1 restart_${NAME}.2
restart         2000000 restart_CO2.1 restart_CO2.2
run             ${Nnvt}
run             200000
PPPM initialization ...
  using 12-bit tables for long-range coulomb (src/kspace.cpp:342)
  G vector (1/distance) = 0.20169663
  grid = 24 24 80
  stencil order = 5
  estimated absolute RMS force accuracy = 0.00286774
  estimated relative force accuracy = 8.6361139e-06
  using single precision FFTW3
  3d grid and FFT values/proc = 82646 46080
Generated 1 of 1 mixed pair_coeff terms from arithmetic mixing rule
Last active /omp style is kspace_style pppm/omp
Per MPI rank memory allocation (min/avg/max) = 34.89 | 34.89 | 34.89 Mbytes
   Step         TotEng         Press           Temp            Dt      
         0  -7416.1221      307.57864      220            0.5          
      1000  -3344.6079      1673.996       223.50432      0.5          
      2000  -2823.3231      1331.6022      198.36884      0.5          
      3000  -2413.1396     -178.03284      212.09993      0.5          
      4000  -2361.489       266.72786      226.6283       0.5          
      5000  -2236.6443      141.86851      222.50378      0.5          
      6000  -1888.3065     -22.801592      217.03318      0.5          
      7000  -1711.5288     -343.18228      210.16254      0.5          
      8000  -1534.8647     -360.97852      215.47797      0.5          
      9000  -1209.9821     -353.43078      221.34283      0.5          
     10000  -1007.1682     -335.78418      219.03631      0.5          
     11000  -801.55421     -151.1276       218.31668      0.5          
     12000  -781.99734     -99.588019      217.79633      0.5          
     13000  -518.09795     -214.03502      222.94008      0.5          
     14000  -534.46874     -259.67954      223.77462      0.5          
     15000  -487.52        -154.89048      221.92026      0.5          
     16000  -546.01386     -304.86389      219.57161      0.5          
     17000  -525.91918     -119.49689      221.28211      0.5          
     18000  -618.73452     -1.8310128      221.17639      0.5          
     19000  -679.21684     -137.89189      219.19775      0.5          
     20000  -735.96299      1.4188832      220.20075      0.5          
     21000  -909.43819     -3.8856813      217.83486      0.5          
     22000  -960.83288     -89.646029      217.40581      0.5          
     23000  -1054.276       37.215038      218.04431      0.5          
     24000  -1062.3283      109.02085      219.04097      0.5          
     25000  -1014.3464      218.70902      222.80822      0.5          
     26000  -1030.0864     -122.6373       221.11426      0.5          
     27000  -1015.5656     -2.3179029      219.99464      0.5          
     28000  -994.44086     -87.215043      220.52365      0.5          
     29000  -938.00683     -148.20737      220.63222      0.5          
     30000  -1020.6391      130.35025      216.7074       0.5          
     31000  -799.19541      214.36817      221.36693      0.5          
     32000  -930.86118     -171.47245      216.91246      0.5          
     33000  -918.60869      35.265869      219.37506      0.5          
     34000  -751.31041      2.4418726      220.69355      0.5          
     35000  -856.12252      159.6705       219.81558      0.5          
     36000  -971.52651      119.84387      219.03441      0.5          
     37000  -954.93418     -17.15487       219.3831       0.5          
     38000  -848.63659     -226.35737      220.83803      0.5          
     39000  -861.42644      151.40856      220.55562      0.5          
     40000  -895.82028      99.565873      218.34607      0.5          
     41000  -853.99508      117.67211      222.04581      0.5          
     42000  -793.24867     -356.03757      220.24738      0.5          
     43000  -702.06546      194.11808      224.211        0.5          
     44000  -805.37113     -189.70258      219.72886      0.5          
     45000  -806.56579     -186.60963      219.09084      0.5          
     46000  -749.00007     -15.372266      218.65567      0.5          
     47000  -736.71867     -180.43292      221.36839      0.5          
     48000  -745.20471     -312.36392      224.99764      0.5          
     49000  -844.64185      68.719204      219.12         0.5          
     50000  -824.70281      218.16516      222.11498      0.5          
     51000  -937.64518     -197.21023      219.27894      0.5          
     52000  -894.72543      42.347733      221.14782      0.5          
     53000  -902.38084      262.58288      217.5448       0.5          
     54000  -810.86329      121.1716       221.13269      0.5          
     55000  -1002.6678      153.52728      215.18834      0.5          
     56000  -914.85097      74.981189      218.0759       0.5          
     57000  -848.04723     -278.54491      220.65153      0.5          
     58000  -891.05754      294.99029      220.8955       0.5          
     59000  -948.6639       286.07303      219.64467      0.5          
     60000  -1004.9768     -168.38294      215.37483      0.5          
     61000  -900.72076      45.768729      221.11734      0.5          
     62000  -917.67282      170.57606      217.78375      0.5          
     63000  -930.08807     -261.82115      218.47656      0.5          
     64000  -748.8705      -18.955241      225.95237      0.5          
     65000  -809.44247     -44.020745      218.93546      0.5          
     66000  -937.62719      178.26881      216.08726      0.5          
     67000  -937.6864      -23.871533      217.81281      0.5          
     68000  -878.99999     -147.51548      217.11936      0.5          
     69000  -754.30751     -62.138159      221.37592      0.5          
     70000  -665.80032     -361.28314      222.07109      0.5          
     71000  -681.81741     -67.746834      224.48478      0.5          
     72000  -806.91265     -276.32649      217.95333      0.5          
     73000  -850.23058     -124.95572      218.72464      0.5          
     74000  -713.22954     -63.480831      221.16357      0.5          
     75000  -909.45566      227.46448      219.87756      0.5          
     76000  -943.28574     -145.66964      220.57973      0.5          
     77000  -963.14669     -125.1904       217.36624      0.5          
     78000  -881.77596      24.408558      217.80497      0.5          
     79000  -933.48475      99.157084      218.04241      0.5          
     80000  -895.59654      60.148674      218.54845      0.5          
     81000  -894.57277     -57.971973      219.45197      0.5          
     82000  -772.42914      328.51989      222.7992       0.5          
     83000  -829.14934     -170.9782       219.32731      0.5          
     84000  -820.9431      -233.09951      218.78436      0.5          
     85000  -836.98532      98.831775      218.63951      0.5          
     86000  -877.34428      75.840428      218.93585      0.5          
